var scene=new THREE.Scene,renderer,controls,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);camera.position.z=350,camera.position.x=0,camera.position.y=10,renderer=new THREE.WebGLRenderer,renderer.setSize(window.innerWidth,window.innerHeight);const wrapper=document.querySelector("#webgl");wrapper.appendChild(renderer.domElement),controls=new THREE.OrbitControls(camera,renderer.domElement),controls.enableZoom=!1;const geometry=new THREE.BufferGeometry,img=new Image;img.src="img/yoko_2k_min.png",img.crossOrigin="anonymous",img.addEventListener("load",()=>{var a=p(img,img.width,img.height,2),e,i,o,n;const h=new THREE.BufferAttribute(new Float32Array(a.position),3),u=new THREE.BufferAttribute(new Float32Array(a.color),3),m=new THREE.BufferAttribute(new Float32Array(a.alpha),1),l=[],s=a.position.length/3;for(let e=0;e<s;e++)l.push((Math.random()-1)*2,(Math.random()-1)*2);const f=new THREE.BufferAttribute(new Float32Array(l),2);geometry.setAttribute("position",h),geometry.setAttribute("color",u),geometry.setAttribute("alpha",m),geometry.setAttribute("rand",f);const b=new THREE.RawShaderMaterial({vertexShader:document.querySelector("#js-vertex-shader").textContent,fragmentShader:document.querySelector("#js-fragment-shader").textContent,uniforms:{u_ratio:{type:"f",value:0},u_time:{type:"f",value:0},move_param:{type:"i",value:0}},transparent:!0});e=new THREE.Points(geometry,b),e.position.x=0,scene.add(e);const t=e.geometry.attributes.alpha.array;i=e.geometry.attributes.position,o=new THREE.Vector2,n=!1,window.setTimeout(c,500),renderer.domElement.addEventListener("mousedown",d);function d(u){u.preventDefault();const t=e.geometry.attributes.position.array;if(n==!0){for(let e=0;e<s;e++){o.x=u.clientX-window.innerWidth/2,o.y=-(u.clientY-window.innerHeight/2),x=i.getX(e)*(500/360),y=i.getY(e)*(500/360);var l=Math.floor(Math.random()*10)+10,r,a,h,m=Math.sqrt(Math.pow(x-o.x,2)+Math.pow(y-o.y,2)),d={x:i.getX(e),y:i.getY(e)};m<10&&(pos_x=t[3*e]+10,pos_y=t[3*e+1]+l*5,r=new TWEEN.Tween(d),r.to({x:pos_x,y:pos_y},5e3),r.easing(TWEEN.Easing.Quadratic.Out),r.onUpdate(function(n){t[3*e]=n.x,t[3*e+1]=n.y}),a=new TWEEN.Tween(d),a.to({x:pos_x+l*5,y:pos_y+l*5},5e3),a.easing(TWEEN.Easing.Quadratic.Out),a.onUpdate(function(n){t[3*e]=n.x,t[3*e+1]=n.y}),h=new TWEEN.Tween(d),h.to({x:t[3*e],y:t[3*e+1]},5e3),h.onUpdate(function(n){t[3*e]=n.x,t[3*e+1]=n.y}),a.chain(h),r.chain(a),r.start())}window.setTimeout(c,500)}n=!1}function c(){n==!1?n=!0:n=!1}r();function p(h,d,l,o){const s=document.createElement("canvas"),i=s.getContext("2d"),t=d,n=l;s.width=t,s.height=n,i.drawImage(h,0,0);const u=i.getImageData(0,0,t,n).data,a=[],r=[],c=[];for(let s=0;s<n;s+=o)for(let i=0;i<t;i+=o){const l=(s*t+i)*4,d=i-t/2,h=-(s-n/2),m=0;var e=[0,255];const f=e[Math.floor(Math.random()*e.length)],p=e[Math.floor(Math.random()*e.length)],g=e[Math.floor(Math.random()*e.length)],v=u[l+3]/255;a.push(d,h,m),r.push(f,p,g),c.push(v)}return{position:a,color:r,alpha:c}}function g(o){for(var e=0,n;e<s;e++)t[e]>0&&(t[e]=.5**6);for(e=0;e<o;e++)for(n=0;n<s;n++)random=n+Math.floor(Math.random()*2)+1,t[random]>0&&(t[random]=.5**(e+7))}function v(n){for(let i=0;i<s;i++){var o={x:t[i]},e=new TWEEN.Tween(o);e.to({x:1},3e3);for(j=0;j<n;j++)t[i]===.5**(j+6)&&(e.delay(j*2e3),e.start());e.onUpdate(function(e){t[i]=e.x})}}function _(e){g(e),v(e+1)}function r(){requestAnimationFrame(r),renderer.render(scene,camera),e.material.uniforms.u_time.value+=.1,TWEEN.update(),e.geometry.attributes.alpha.needsUpdate=!0,e.geometry.attributes.position.needsUpdate=!0}})