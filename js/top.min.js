var scene=new THREE.Scene,renderer,controls,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);camera.position.z=350,camera.position.x=0,camera.position.y=10,renderer=new THREE.WebGLRenderer,renderer.setSize(window.innerWidth,window.innerHeight);const wrapper=document.querySelector("#webgl");wrapper.appendChild(renderer.domElement),controls=new THREE.OrbitControls(camera,renderer.domElement),controls.enableZoom=!1;const geometry=new THREE.BufferGeometry,img=new Image;img.src="img/yoko_2k_min.png",img.crossOrigin="anonymous",img.addEventListener("load",()=>{var s=d(img,img.width,img.height,2),t;const l=new THREE.BufferAttribute(new Float32Array(s.position),3),c=new THREE.BufferAttribute(new Float32Array(s.color),3),r=new THREE.BufferAttribute(new Float32Array(s.alpha),1),o=[],n=s.position.length/3;for(let e=0;e<n;e++)o.push((Math.random()-1)*2,(Math.random()-1)*2);const a=new THREE.BufferAttribute(new Float32Array(o),2);geometry.setAttribute("position",l),geometry.setAttribute("color",c),geometry.setAttribute("alpha",r),geometry.setAttribute("rand",a);const f=new THREE.RawShaderMaterial({vertexShader:document.querySelector("#js-vertex-shader").textContent,fragmentShader:document.querySelector("#js-fragment-shader").textContent,uniforms:{u_ratio:{type:"f",value:0},u_time:{type:"f",value:0},move_param:{type:"i",value:0}},transparent:!0});t=new THREE.Points(geometry,f),t.position.x=0,scene.add(t);const e=t.geometry.attributes.alpha.array;m(3),i();function d(h,d,l,o){const s=document.createElement("canvas"),i=s.getContext("2d"),t=d,n=l;s.width=t,s.height=n,i.drawImage(h,0,0);const u=i.getImageData(0,0,t,n).data,a=[],r=[],c=[];for(let s=0;s<n;s+=o)for(let i=0;i<t;i+=o){const l=(s*t+i)*4,d=i-t/2,h=-(s-n/2),m=0;var e=[0,255];const f=e[Math.floor(Math.random()*e.length)],p=e[Math.floor(Math.random()*e.length)],g=e[Math.floor(Math.random()*e.length)],v=u[l+3]/255;a.push(d,h,m),r.push(f,p,g),c.push(v)}return{position:a,color:r,alpha:c}}function u(o){for(var t=0,s;t<n;t++)e[t]>0&&(e[t]=.5**6);for(t=0;t<o;t++)for(s=0;s<n;s++)random=s+Math.floor(Math.random()*2)+1,e[random]>0&&(e[random]=.5**(t+7))}function h(s){for(let i=0;i<n;i++){var o={x:e[i]},t=new TWEEN.Tween(o);t.to({x:1},3e3);for(j=0;j<s;j++)e[i]===.5**(j+6)&&(t.delay(j*2e3),t.start());t.onUpdate(function(t){e[i]=t.x})}}function m(e){u(e),h(e+1)}function i(){requestAnimationFrame(i),renderer.render(scene,camera),t.material.uniforms.u_time.value+=.1,TWEEN.update(),t.geometry.attributes.alpha.needsUpdate=!0}})