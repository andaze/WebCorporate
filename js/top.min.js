var scene=new THREE.Scene,camera,renderer;const width=window.innerWidth,height=window.innerHeight;camera=new THREE.PerspectiveCamera(75,width/height,.1,1500),camera.position.x=0,camera.position.y=30,renderer=new THREE.WebGLRenderer;const header_height=document.getElementById("header_nav").clientHeight;renderer.setSize(width,height-header_height);const wrapper=document.querySelector("#webgl");wrapper.appendChild(renderer.domElement);const geometry=new THREE.BufferGeometry,img=new Image;img.src="../img/logo.png",img.crossOrigin="anonymous",img.addEventListener("load",()=>{var e,n,o,i,a,r,c,u,h,m,p,v,b,y,O,C,E,A,S,M,F,T,z,D,N,L,R,P,H,I,B,G,X,d=es(img,img.width,img.height,2);const ed=new THREE.BufferAttribute(new Float32Array(d.position),3),eu=new THREE.BufferAttribute(new Float32Array(d.color),3),el=new THREE.BufferAttribute(new Float32Array(d.alpha),1),W=[],f=d.position.length/3;for(let e=0;e<f;e++)W.push((Math.random()-1)*2,(Math.random()-1)*2);const Q=new THREE.BufferAttribute(new Float32Array(W),2),$=[];for(let e=0;e<f;e++)$.push(1);const ei=new THREE.BufferAttribute(new Float32Array($),1);geometry.setAttribute("position",ed),geometry.setAttribute("color",eu),geometry.setAttribute("alpha",el),geometry.setAttribute("rand",Q),geometry.setAttribute("flag",ei);const er=new THREE.RawShaderMaterial({vertexShader:document.querySelector("#js-vertex-shader").textContent,fragmentShader:document.querySelector("#js-fragment-shader").textContent,uniforms:{u_ratio:{type:"f",value:0},u_time:{type:"f",value:0},u_value:{type:"f",value:0},pointTexture:{value:(new THREE.TextureLoader).load("../img/triangle.png")}},transparent:!0,blending:THREE.AdditiveBlending,depthTest:!1});e=new THREE.Points(geometry,er),n=e.geometry.attributes.position;const g=e.geometry.attributes.alpha.array,e4=e.geometry.attributes.color.array,s=e.geometry.attributes.position.array,l=e.geometry.attributes.flag.array,x=4,_=500;F=0,D=0;const en=new THREE.Clock;B=[],I=new THREE.Raycaster,y=new THREE.Vector2(-2,-2),u=new THREE.Vector2,v=new THREE.Vector2,i=new THREE.Vector2,h=new THREE.Vector2,z={x1:e.position.x,y1:e.position.y,z1:e.position.z,x2:e.rotation.x,y2:e.rotation.y,z2:e.rotation.z},c=new THREE.Vector2,a=new THREE.Vector2,A=new THREE.Vector2,o=new THREE.Vector2,S=new THREE.Vector2,E=new THREE.Vector2,b=new THREE.Vector2,M=new THREE.Vector2,R=new THREE.Vector2,C=new THREE.Vector2,O=!1,p=!1,T=!1,L=!1,N=!1,scene.add(e),B.push(e),window.setTimeout(()=>{ee(x-1,_),window.setTimeout(et,x*_),window.setTimeout(k,x*_)},500),ea(),typeof window.ontouchstart=="undefined"?(renderer.domElement.addEventListener("mousedown",U),renderer.domElement.addEventListener("mouseup",Y)):(renderer.domElement.addEventListener("touchstart",U),renderer.domElement.addEventListener("touchend",Y)),q(),K(),G=window.innerWidth,H=window.innerHeight,window.addEventListener("resize",function(){if(G==window.innerWidth&typeof window.ontouchstart!="undefined"){H<window.innerHeight?nav_block.style.bottom=height*.15+100+"px":nav_block.style.bottom=height*.15+"px";return}H=window.innerHeight,K()}),eo(),window.setTimeout(()=>{window.setInterval(ec,1e3),window.addEventListener("blur",()=>{N=!0}),window.addEventListener("focus",()=>{N=!1})},x*_+5e3+t(5,1)*1e3);function es(h,d,l,o){const s=document.createElement("canvas"),i=s.getContext("2d"),t=d,n=l;s.width=t,s.height=n,i.drawImage(h,0,0);const u=i.getImageData(0,0,t,n).data,a=[],r=[],c=[];for(let s=0;s<n;s+=o)for(let i=0;i<t;i+=o){const d=(s*t+i)*4,v=i-t/2,h=-(s-n/2),m=0;var e=[0,1];const f=e[Math.floor(Math.random()*e.length)],p=e[Math.floor(Math.random()*e.length)],g=e[Math.floor(Math.random()*e.length)],l=u[d+3]/255;l>0&&(a.push(v,h,m),r.push(f,p,g),c.push(l))}return{position:a,color:r,alpha:c}}function Z(n){for(var t,e=0;e<f;e++)g[e]>0&&(g[e]=.5**6);for(e=0;e<n;e++)for(t=0;t<f;t++)random=t+Math.floor(Math.random()*2)+1,g[random]>0&&(g[random]=.5**(e+7))}function J(n,t){for(let o=0;o<f;o++){var s={x:g[o],y:l[o]},e=new TWEEN.Tween(s);e.to({x:1,y:1},t+1e3);for(j=0;j<n;j++)g[o]===.5**(j+6)&&(e.delay(j*t),e.start());e.onUpdate(function(e){g[o]=e.x,l[o]=e.y})}}function ee(e,t){Z(e),J(e+1,t)}function et(){O==!1?O=!0:O=!1}function k(){p===!1?p=!0:p===!0&&(p=!1)}function V(){X=setTimeout(function(){F=Date.now()-P+D,V()},10),r=F/1e3}function U(e){u.x=e.clientX-width/2,u.y=-(e.clientY-height/2)+header_height+camera.position.y,y.x=e.clientX/width*2-1,y.y=-(e.clientY/height)*2+1,typeof window.ontouchstart!="undefined"&&(u.x=e.changedTouches[0].pageX-width/2,u.y=-(e.changedTouches[0].pageY-height/2)+header_height+camera.position.y,y.x=e.changedTouches[0].pageX/width*2-1,y.y=-(e.changedTouches[0].pageY/height)*2+1),I.setFromCamera(y,camera);var t=I.intersectObjects(B);t.length>0&&(e.preventDefault(),L=!0),P=Date.now(),V()}function Y(b){if(L===!0&&b.preventDefault(),v.x=b.clientX-width/2,v.y=-(b.clientY-height/2)+header_height+camera.position.y,typeof window.ontouchstart!="undefined"&&(v.x=b.changedTouches[0].pageX-width/2,v.y=-(b.changedTouches[0].pageY-height/2)+header_height+camera.position.y),i.x=v.x-u.x,i.y=v.y-u.y,h.x=Math.abs(i.x),h.y=Math.abs(i.y),O==!0)for(let v=0;v<f;v++){c.x=n.getX(v)*(500/camera.position.z)-8,c.y=n.getY(v)*(500/camera.position.z)+8;var d,g,j,_={x:n.getX(v),y:n.getY(v),z:l[v]},y=Math.sqrt(Math.pow(c.x-u.x,2)+Math.pow(c.y-u.y,2));if(typeof window.ontouchstart!="undefined"?(j=3):(j=2),l[v]===1&&y<5/(r*6)*j&r>.01){if(l[v]=0,i.x>0&h.y<20)a.x=1,a.y=0,m=t(50,40);else if(i.x<0&h.y<20)a.x=-1,a.y=0,m=t(50,40);else if(i.y>0&h.y>=20)a.x=0,a.y=1,m=t(50,40);else if(i.y<0&h.y>=20)a.x=0,a.y=-1,m=t(50,40);else if(h.x<5|h.y<5)return;A.x=m*a.x,A.y=m*a.y,o.x=s[3*v]+A.x+i.x/(r*20),o.y=s[3*v+1]+A.y+i.y/(r*20),d=new TWEEN.Tween(_),d.to({x:o.x,y:o.y,z:0},r*3e4),d.easing(TWEEN.Easing.Quadratic.Out),d.onUpdate(function(e){s[3*v]=e.x,s[3*v+1]=e.y,l[v]=e.z}),d.repeat(1),d.yoyo(!0),g=new TWEEN.Tween(z),g.to({x1:o.x/(r*1e3),y1:o.y*-1/(r*1e3),z1:e.position.z+2e3/(r*300),x2:o.y/1e3*-1,y2:o.x/1e3*-1},r*1e5),g.delay(2e3),g.onUpdate(function(t){e.position.x=t.x1,e.position.y=t.y1,e.position.z=t.z1,e.rotation.x=t.x2,e.rotation.y=t.y2}),g.repeat(1),g.yoyo(!0),d.start(),nav_block.style.opacity=0,nav_block.style.visibility="hidden",T=!0,p===!0&&(g.start(),k(),window.setTimeout(k,r*1e5*2+4e3))}}clearTimeout(X),D+=Date.now()-P,F=0,D=0,L=!1}function q(){var t=en.getDelta();requestAnimationFrame(q),renderer.render(scene,camera),window.setTimeout(()=>{e.material.uniforms.u_time.value+=2*t},x*_-500),TWEEN.update(),e.geometry.attributes.alpha.needsUpdate=!0,e.geometry.attributes.position.needsUpdate=!0,e.geometry.attributes.flag.needsUpdate=!0}function K(){const n=window.innerWidth,t=window.innerHeight,s=document.getElementById("header_nav").clientHeight;canvas.style.marginTop=s+"px";const o=700,i=864,a=1440;camera.aspect=n/(t-s),camera.updateProjectionMatrix(),typeof window.ontouchstart=="undefined"?n>=o?(camera.position.z=400,t<=i?e.material.uniforms.u_value.value=(n+t)/1800-(1200+t)/n:e.material.uniforms.u_value.value=(n+t)/700-(1200+t)/n):(camera.position.z=t/n*400,e.material.uniforms.u_value.value=(n+t)/1800-(1200+t)/n):n>=a?n<t?(camera.position.z=t/n*500,e.material.uniforms.u_value.value=(n+t)/500-(1200+t)/n):camera.aspect>1.85?(camera.position.z=n/t*250,e.material.uniforms.u_value.value=(n+t)/800-(2800+t)/n):(camera.position.z=n/t*350,e.material.uniforms.u_value.value=(n+t)/500-(2800+t)/n):n<t?(camera.position.z=t/n*400,e.material.uniforms.u_value.value=(n+t)/500-(1600+t)/n,nav_block.style.bottom=t*.15+"px"):camera.aspect>1.8?(camera.position.z=n/t*250,e.material.uniforms.u_value.value=(n+t)/800-(3400+t)/n,nav_block.style.display="none"):(camera.position.z=n/t*350,e.material.uniforms.u_value.value=(n+t)/800-(2800+t)/n,nav_block.style.bottom=t*.15+"px"),renderer.setSize(n,t-s)}function ec(){if(N===!0)return;m=t(200,50);var i,a,r,c,d,u,h,g,v,j,y,_,A=[[Math.random(),Math.random()],[-1*Math.random(),Math.random()],[Math.random(),-1*Math.random()],[-1*Math.random(),-1*Math.random()]],x=A[Math.floor(Math.random()*A.length)],D=m*x[0],F=m*x[1];if(S.x=t(375,0),E.x=-1*t(400,0),S.y=t(410,0),E.y=-1*t(230,0),b.x=[S.x,E.x],b.y=[S.y,E.y],M.x=b.x[Math.floor(Math.random()*b.x.length)],M.y=b.y[Math.floor(Math.random()*b.y.length)],C.x=t(200,5)*w(),C.y=t(200,5)*w(),typeof window.ontouchstart!="undefined"?(u=30):(u=20),O==!0)for(let m=0;m<f;m++)_=n.getX(m)*(500/camera.position.z)-8,y=n.getY(m)*(500/camera.position.z)+8,j={x:n.getX(m),y:n.getY(m),z:l[m]},v=Math.sqrt(Math.pow(_-M.x,2)+Math.pow(y-M.y,2)),g=[[1,0],[-1,0],[0,1],[0,-1]],h=g[Math.floor(Math.random()*g.length)],R.x=h[0],R.y=h[1],i=t(110,80)*.001,l[m]===1&&v<u&&(l[m]=0,d=t(300,280)*t(1500,1e3),o.x=s[3*m]+D+C.x/(i*d),o.y=s[3*m+1]+F+C.y/(i*d),a=new TWEEN.Tween(j),a.to({x:o.x,y:o.y,z:0},i*d),a.easing(TWEEN.Easing.Quadratic.Out),a.onUpdate(function(e){s[3*m]=e.x,s[3*m+1]=e.y,l[m]=e.z}),a.repeat(1),a.yoyo(!0),r=new TWEEN.Tween(z),r.to({x1:o.x/(i*1e3),y1:o.y*-1/(i*1e3),z1:e.position.z+2e3/(i*500),x2:o.y/1e3*-1,y2:o.x/1e3*-1},1e4),r.delay(2e3),r.onUpdate(function(t){e.position.x=t.x1,e.position.y=t.y1,e.position.z=t.z1,e.rotation.x=t.x2,e.rotation.y=t.y2}),c=new TWEEN.Tween(z),c.to({x1:e.position.x,y1:e.position.y,z1:e.position.z,x2:e.rotation.x,y2:e.rotation.y},1e4),c.delay(2e3),c.onUpdate(function(t){e.position.x=t.x1,e.position.y=t.y1,e.position.z=t.z1,e.rotation.x=t.x2,e.rotation.y=t.y2}),r.chain(c),a.start(),T=!0,p===!0&e.position.z+2e3/(i*500)<=camera.position.z*.3&&(r.start(),k(),window.setTimeout(k,12e3*2)))}function t(t,e){return Math.floor(Math.random()*t+1-e)+e}function w(){var e=[1,-1];return e[Math.floor(Math.random()*e.length)]}function e1(){gsap.set(e.material.uniforms.u_ratio,{value:1e4}),window.setTimeout(()=>{gsap.to(e.material.uniforms.u_ratio,{value:0,duration:5,ease:"power4.out"})},0)}function ea(){for(let i=0;i<f;i++){s[3*i]=t(600,0)*w(),s[3*i+1]=t(600,0)*w(),c.x=n.getX(i)*(500/camera.position.z)-8,c.y=n.getY(i)*(500/camera.position.z)+8;var o={x:n.getX(i),y:n.getY(i)},e=new TWEEN.Tween(o);e.to({x:d.position[3*i],y:d.position[3*i+1]},3e3),e.easing(TWEEN.Easing.Quadratic.Out),e.onUpdate(function(e){s[3*i]=e.x,s[3*i+1]=e.y}),e.start()}}function e0(){for(let i=0;i<f;i++){s[3*i]=t(600,0)*w(),s[3*i+1]=t(600,0)*w(),s[3*i+2]=1e3,c.x=n.getX(i)*(500/camera.position.z)-8,c.y=n.getY(i)*(500/camera.position.z)+8,c.z=n.getZ(i)*(500/camera.position.z);var o={x:n.getX(i),y:n.getY(i),z:n.getZ(i)},e=new TWEEN.Tween(o);e.to({x:d.position[3*i],y:d.position[3*i+1],z:d.position[3*i+2]},3e3),e.easing(TWEEN.Easing.Quadratic.Out),e.onUpdate(function(e){s[3*i]=e.x,s[3*i+1]=e.y,s[3*i+2]=e.z}),e.start()}}function eo(){const t=document.getElementById("nav_block"),e=document.getElementById("circle"),n=gsap.timeline();n.to(e,{duration:.5,opacity:.7,y:5}).to(e,{duration:.5,x:anime_nav.clientWidth*.5}).to(e,{duration:.8,opacity:0,x:anime_nav.clientWidth*.8,y:-5}),n.repeat(-1),window.setTimeout(()=>{T===!1&&(t.style.opacity=1,t.style.visibility="visible")},x*_+5e3)}})