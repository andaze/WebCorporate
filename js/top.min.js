var scene=new THREE.Scene,renderer,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);camera.position.z=350,camera.position.x=0,camera.position.y=20,renderer=new THREE.WebGLRenderer;const header_height=60,bar_width=17,canvas_wrapper=document.getElementById("canvas-wrapper");typeof window.ontouchstart=="undefined"?renderer.setSize(window.innerWidth-bar_width,window.innerHeight-header_height):renderer.setSize(window.innerWidth,window.innerHeight-header_height);const wrapper=document.querySelector("#webgl");wrapper.appendChild(renderer.domElement);const geometry=new THREE.BufferGeometry,img=new Image;img.src="../img/logo.png",img.crossOrigin="anonymous",img.addEventListener("load",()=>{var e,t,n,s,o,i,l,d,u,h,m,f,v,y,_,w,z,b=P(img,img.width,img.height,2);const D=new THREE.BufferAttribute(new Float32Array(b.position),3),R=new THREE.BufferAttribute(new Float32Array(b.color),3),V=new THREE.BufferAttribute(new Float32Array(b.alpha),1),S=[],r=b.position.length/3;for(let e=0;e<r;e++)S.push((Math.random()-1)*2,(Math.random()-1)*2);const U=new THREE.BufferAttribute(new Float32Array(S),2),A=[];for(let e=0;e<r;e++)A.push(1);const $=new THREE.BufferAttribute(new Float32Array(A),1);geometry.setAttribute("position",D),geometry.setAttribute("color",R),geometry.setAttribute("alpha",V),geometry.setAttribute("rand",U),geometry.setAttribute("flag",$);const W=new THREE.RawShaderMaterial({vertexShader:document.querySelector("#js-vertex-shader").textContent,fragmentShader:document.querySelector("#js-fragment-shader").textContent,uniforms:{u_ratio:{type:"f",value:0},u_time:{type:"f",value:0},u_value:{type:"f",value:0},pointTexture:{value:(new THREE.TextureLoader).load("../img/spark.png")}},transparent:!0,blending:THREE.AdditiveBlending,depthTest:!1});e=new THREE.Points(geometry,W),e.position.x=0,u=e.geometry.attributes.position;const a=e.geometry.attributes.alpha.array,Y=e.geometry.attributes.color.array,c=e.geometry.attributes.flag.array,p=4,g=500;m=0,v=0;const K=new THREE.Clock;y=[],w=new THREE.Raycaster,d=new THREE.Vector2(-2,-2),s=new THREE.Vector2,i=new THREE.Vector2,n=new THREE.Vector2,o=new THREE.Vector2,h=!1,l=!1,f=!1,scene.add(e),y.push(e),window.setTimeout(()=>{const e=document.getElementById("loading");e.style.opacity=0,e.style.visibility="hidden",B(p-1,g),window.setTimeout(q,p*g),window.setTimeout(O,p*g)},500),typeof window.ontouchstart=="undefined"?(renderer.domElement.addEventListener("mousedown",C),renderer.domElement.addEventListener("mouseup",k)):(renderer.domElement.addEventListener("touchstart",C),renderer.domElement.addEventListener("touchend",k));const x=document.getElementById("hidden_cover"),N=document.querySelector("main"),L=N.getBoundingClientRect(),T=window.pageYOffset+L.y*.2;window.addEventListener("scroll",()=>{window.scrollY>=T?x.style.opacity=.5:window.scrollY<T&&(x.style.opacity=0)}),F(),M(),window.addEventListener("resize",M);function P(h,d,l,o){const s=document.createElement("canvas"),i=s.getContext("2d"),t=d,n=l;s.width=t,s.height=n,i.drawImage(h,0,0);const u=i.getImageData(0,0,t,n).data,a=[],r=[],c=[];for(let s=0;s<n;s+=o)for(let i=0;i<t;i+=o){const d=(s*t+i)*4,v=i-t/2,h=-(s-n/2),m=0;var e=[0,255];const f=e[Math.floor(Math.random()*e.length)],p=e[Math.floor(Math.random()*e.length)],g=e[Math.floor(Math.random()*e.length)],l=u[d+3]/255;l>0&&(a.push(v,h,m),r.push(f,p,g),c.push(l))}return{position:a,color:r,alpha:c}}function H(n){for(var t,e=0;e<r;e++)a[e]>0&&(a[e]=.5**6);for(e=0;e<n;e++)for(t=0;t<r;t++)random=t+Math.floor(Math.random()*2)+1,a[random]>0&&(a[random]=.5**(e+7))}function I(n,t){for(let o=0;o<r;o++){var s={x:a[o],y:c[o]},e=new TWEEN.Tween(s);e.to({x:1,y:1},t+1e3);for(j=0;j<n;j++)a[o]===.5**(j+6)&&(e.delay(j*t),e.start());e.onUpdate(function(e){a[o]=e.x,c[o]=e.y})}}function B(e,t){H(e),I(e+1,t)}function q(){h==!1?h=!0:h=!1}function O(){l===!1?l=!0:l===!0&&(l=!1)}function E(){z=setTimeout(function(){m=Date.now()-_+v,E()},10),t=m/1e3}function C(e){s.x=e.clientX-window.innerWidth/2,s.y=-(e.clientY-window.innerHeight/2)+header_height+camera.position.y,d.x=e.clientX/window.innerWidth*2-1,d.y=-(e.clientY/window.innerHeight)*2+1,typeof window.ontouchstart!="undefined"&&(s.x=e.changedTouches[0].pageX-window.innerWidth/2,s.y=-(e.changedTouches[0].pageY-window.innerHeight/2)+header_height+camera.position.y,d.x=e.changedTouches[0].pageX/window.innerWidth*2-1,d.y=-(e.changedTouches[0].pageY/window.innerHeight)*2+1),w.setFromCamera(d,camera);var t=w.intersectObjects(y);t.length>0&&(e.preventDefault(),f=!0),_=Date.now(),E()}function k(j){f===!0&&j.preventDefault();const x=e.geometry.attributes.position.array;if(i.x=j.clientX-window.innerWidth/2,i.y=-(j.clientY-window.innerHeight/2)+header_height+camera.position.y,typeof window.ontouchstart!="undefined"&&(i.x=j.changedTouches[0].pageX-window.innerWidth/2,i.y=-(j.changedTouches[0].pageY-window.innerHeight/2)+header_height+camera.position.y),n.x=i.x-s.x,n.y=i.y-s.y,o.x=Math.abs(n.x),o.y=Math.abs(n.y),h==!0)for(let i=0;i<r;i++){var a,d,p,g,b,y,w,C,A,S,T=u.getX(i)*(500/camera.position.z)-8,F=u.getY(i)*(500/camera.position.z)+8,M={x:u.getX(i),y:u.getY(i),z:c[i]},E={x1:e.position.x,y1:e.position.y,z1:e.position.z,x2:e.rotation.x,y2:e.rotation.y,z2:e.rotation.z},k=Math.sqrt(Math.pow(T-s.x,2)+Math.pow(F-s.y,2));if(typeof window.ontouchstart!="undefined"?C=3:C=2,c[i]===1&&k<10/(t*6)*C&t>.01){if(c[i]=0,n.x>0&o.y<20)g=1,b=0,p=Math.floor(Math.random()*50+1-40)+40;else if(n.x<0&o.y<20)g=-1,b=0,p=Math.floor(Math.random()*50+1-40)+40;else if(n.y>0&o.y>=20)g=0,b=1,p=Math.floor(Math.random()*50+1-40)+40;else if(n.y<0&o.y>=20)g=0,b=-1,p=Math.floor(Math.random()*20+1-10)+10;else if(o.x<5|o.y<5)return;A=p*g,S=p*b,y=x[3*i]+A+n.x/(t*20),w=x[3*i+1]+S+n.y/(t*20),a=new TWEEN.Tween(M),a.to({x:y,y:w,z:0},t*3e4),a.easing(TWEEN.Easing.Quadratic.Out),a.onUpdate(function(e){x[3*i]=e.x,x[3*i+1]=e.y,c[i]=e.z}),a.repeat(1),a.yoyo(!0),d=new TWEEN.Tween(E),d.to({x1:y/(t*1e3),y1:w*-1/(t*1e3),z1:e.position.z+2e3/(t*300),x2:w/1e3*-1,y2:y/1e3*-1},t*1e5),d.delay(2e3),d.onUpdate(function(t){e.position.x=t.x1,e.position.y=t.y1,e.position.z=t.z1,e.rotation.x=t.x2,e.rotation.y=t.y2}),d.repeat(1),d.yoyo(!0),a.start(),l===!0&&(d.start(),O(),window.setTimeout(O,t*1e5*2+4e3))}}clearTimeout(z),v+=Date.now()-_,m=0,v=0,f=!1}function F(){var t=K.getDelta();requestAnimationFrame(F),renderer.render(scene,camera),window.setTimeout(()=>{e.material.uniforms.u_time.value+=2*t},p*g-500),TWEEN.update(),e.geometry.attributes.alpha.needsUpdate=!0,e.geometry.attributes.position.needsUpdate=!0,e.geometry.attributes.flag.needsUpdate=!0}function M(){const t=window.innerWidth,c=window.innerHeight,s=3840,o=2560,i=1920,a=1440,r=1280,n=840,l=650;typeof window.ontouchstart=="undefined"?t>=s?(camera.position.z=350,e.material.uniforms.u_value.value=18):t<s&t>=o?(camera.position.z=350,e.material.uniforms.u_value.value=10):t<o&t>=i?(camera.position.z=350,e.material.uniforms.u_value.value=4):t<i&t>=a?(camera.position.z=350,e.material.uniforms.u_value.value=1):t<a&t>=r?(camera.position.z=350,e.material.uniforms.u_value.value=1):t<r&t>=n?(camera.position.z=350,e.material.uniforms.u_value.value=1):t<n&t>=l?(camera.position.z=450,e.material.uniforms.u_value.value=-1):(camera.position.z=740,e.material.uniforms.u_value.value=-4):t>=s?(camera.position.z=350,e.material.uniforms.u_value.value=27):t<s&t>=o?(camera.position.z=350,e.material.uniforms.u_value.value=16):t<o&t>=i?(camera.position.z=350,e.material.uniforms.u_value.value=9):t<i&t>=a?(camera.position.z=350,e.material.uniforms.u_value.value=5):t<a&t>=r?(camera.position.z=350,e.material.uniforms.u_value.value=3):t<r&t>=n?(camera.position.z=350,e.material.uniforms.u_value.value=0):t<n&t>=l?(camera.position.z=450,e.material.uniforms.u_value.value=-2):(camera.position.z=740,e.material.uniforms.u_value.value=-5),typeof window.ontouchstart=="undefined"?renderer.setSize(t-bar_width,c-header_height):renderer.setSize(t,c-header_height),camera.aspect=t/(c-header_height),camera.updateProjectionMatrix()}})