console.log("hello");function ImagePixel(l,d,u,o){const s=document.createElement("canvas"),i=s.getContext("2d"),e=d,t=u;s.width=e,s.height=t,i.drawImage(l,0,0);const n=i.getImageData(0,0,e,t).data,a=[],r=[],c=[];for(let s=0;s<t;s+=o)for(let i=0;i<e;i+=o){const l=(s*e+i)*4,d=n[l]/255,u=n[l+1]/255,h=n[l+2]/255,m=n[l+3]/255,f=i-e/2,p=-(s-t/2),g=0;a.push(f,p,g),r.push(d,u,h),c.push(m)}return{position:a,color:r,alpha:c}}class Stage{constructor(){this.renderParam={clearColor:1579032,width:document.body.clientWidth,height:window.innerHeight},this.cameraParam={fov:30,near:.1,far:5e3,lookAt:new THREE.Vector3(0,0,0),x:1,y:0,z:3200},this.scene=null,this.camera=null,this.renderer=null,this.isInitialized=!1,this.orbitcontrols=null,this.isDev=!1}init(){this._setScene(),this._setRender(),this._setCamera(),this._setDev()}_setScene(){this.scene=new THREE.Scene}_setRender(){this.renderer=new THREE.WebGLRenderer,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setClearColor(new THREE.Color(this.renderParam.clearColor)),this.renderer.setSize(this.renderParam.width,this.renderParam.height);const e=document.querySelector("#webgl");e.appendChild(this.renderer.domElement)}_setCamera(){this.isInitialized||(this.camera=new THREE.PerspectiveCamera(0,0,this.cameraParam.near,this.cameraParam.far),this.camera.position.set(this.cameraParam.x,this.cameraParam.y,this.cameraParam.z),this.camera.lookAt(this.cameraParam.lookAt),this.isInitialized=!0);const e=document.body.clientWidth,t=window.innerHeight;this.camera.aspect=e/t,this.camera.fov=this.cameraParam.fov,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}_setDev(){this.orbitcontrols=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.orbitcontrols.enableDamping=!0,this.orbitcontrols.enablePan=!1,this.isDev=!0}_render(){this.renderer.render(this.scene,this.camera),this.isDev&&this.orbitcontrols.update()}onResize(){this._setCamera()}onRaf(){this._render()}}class Particle{constructor(e){this.stage=e,this.promiseList=[],this.pathList=["img/yoko_c2.png"],this.imageList=[]}init(){this.pathList.forEach(e=>{this.promiseList.push(new Promise(n=>{const t=new Image;t.src=e,t.crossOrigin="anonymous",t.addEventListener("load",()=>{this.imageList.push(ImagePixel(t,t.width,t.height,4)),n()})}))}),Promise.all(this.promiseList).then(()=>{this._setMesh(),this._setAutoPlay()})}_setMesh(){const e=new THREE.BufferGeometry,n=new THREE.BufferAttribute(new Float32Array(this.imageList[0].position),3),s=new THREE.BufferAttribute(new Float32Array(this.imageList[0].color),3),o=new THREE.BufferAttribute(new Float32Array(this.imageList[0].alpha),1),t=[],i=this.imageList[0].position.length/3;for(let e=0;e<i;e++)t.push((Math.random()-1)*2,(Math.random()-1)*2);const a=new THREE.BufferAttribute(new Float32Array(t),2);e.setAttribute("position",n),e.setAttribute("color",s),e.setAttribute("alpha",o),e.setAttribute("rand",a);const r=new THREE.RawShaderMaterial({vertexShader:document.querySelector("#js-vertex-shader").textContent,fragmentShader:document.querySelector("#js-fragment-shader").textContent,uniforms:{u_ratio:{type:"f",value:0},u_time:{type:"f",value:0}},transparent:!0});this.mesh=new THREE.Points(e,r),this.stage.scene.add(this.mesh)}_setDiffusion(){gsap.to(this.mesh.material.uniforms.u_ratio,{value:1,duration:1.8,ease:"power1.inOut",repeat:1,yoyo:!0})}_setAutoPlay(){this._setDiffusion(),gsap.to({},{ease:"none",duration:4.2,repeat:-1,onRepeat:()=>{this._setDiffusion()}})}_render(){this.mesh&&(this.mesh.material.uniforms.u_time.value+=.02)}onResize(){}onRaf(){this._render()}}class Webgl{constructor(){const e=new Stage;e.init();const t=new Particle(e);t.init(),window.addEventListener("resize",()=>{e.onResize(),t.onResize()});const n=()=>{window.requestAnimationFrame(()=>{n(),e.onRaf(),t.onRaf()})};n()}}new Webgl