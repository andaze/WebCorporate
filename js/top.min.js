const loading_icon=document.getElementById("loading_icon");window.setTimeout(()=>{loading_icon.style.visibility="visible"},1);var scene=new THREE.Scene,renderer,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);camera.position.z=400,camera.position.x=0,camera.position.y=30,renderer=new THREE.WebGLRenderer;const header_height=document.getElementById("header_nav").clientHeight,bar_width=17,main_height=document.getElementById("top_main").clientHeight;document.querySelector("footer").style.marginTop=main_height+"px";const canvas=document.getElementById("webgl");canvas.style.marginTop=header_height+"px",typeof window.ontouchstart=="undefined"?renderer.setSize(window.innerWidth-bar_width,window.innerHeight-header_height):renderer.setSize(window.innerWidth,window.innerHeight-header_height);const wrapper=document.querySelector("#webgl");wrapper.appendChild(renderer.domElement);const geometry=new THREE.BufferGeometry,img=new Image;img.src="../img/logo.png",img.crossOrigin="anonymous",img.addEventListener("load",()=>{var e,t,s,o,i,r,c,l,d,f,p,v,y,w,O,x,C,E,A,S,T,N,R,P,H,I,B,V,$,L=eo(img,img.width,img.height,2),et;const e4=new THREE.BufferAttribute(new Float32Array(L.position),3),el=new THREE.BufferAttribute(new Float32Array(L.color),3),eh=new THREE.BufferAttribute(new Float32Array(L.alpha),1),U=[],g=L.position.length/3;for(let e=0;e<g;e++)U.push((Math.random()-1)*2,(Math.random()-1)*2);const eu=new THREE.BufferAttribute(new Float32Array(U),2),q=[];for(let e=0;e<g;e++)q.push(1);const e1=new THREE.BufferAttribute(new Float32Array(q),1);geometry.setAttribute("position",e4),geometry.setAttribute("color",el),geometry.setAttribute("alpha",eh),geometry.setAttribute("rand",eu),geometry.setAttribute("flag",e1);const e0=new THREE.RawShaderMaterial({vertexShader:document.querySelector("#js-vertex-shader").textContent,fragmentShader:document.querySelector("#js-fragment-shader").textContent,uniforms:{u_ratio:{type:"f",value:0},u_time:{type:"f",value:0},u_value:{type:"f",value:0},pointTexture:{value:(new THREE.TextureLoader).load("../img/spark.png")}},transparent:!0,blending:THREE.AdditiveBlending,depthTest:!1});e=new THREE.Points(geometry,e0),e.position.x=0,r=e.geometry.attributes.position;const h=e.geometry.attributes.alpha.array,em=e.geometry.attributes.color.array,u=e.geometry.attributes.position.array,a=e.geometry.attributes.flag.array,_=4,b=500;R=0,N=0;const e2=new THREE.Clock;V=[],B=new THREE.Raycaster,w=new THREE.Vector2(-2,-2),c=new THREE.Vector2,v=new THREE.Vector2,o=new THREE.Vector2,l=new THREE.Vector2,T={x1:e.position.x,y1:e.position.y,z1:e.position.z,x2:e.rotation.x,y2:e.rotation.y,z2:e.rotation.z},E=new THREE.Vector2,s=new THREE.Vector2,S=new THREE.Vector2,t=new THREE.Vector2,O=new THREE.Vector2,A=new THREE.Vector2,f=new THREE.Vector2,C=new THREE.Vector2,$=new THREE.Vector2,x=new THREE.Vector2,y=!1,p=!1,P=!1,H=!1,scene.add(e),V.push(e),window.setTimeout(()=>{const e=document.getElementById("loading");e.style.opacity=0,e.style.visibility="hidden",er(_-1,b),window.setTimeout(ec,_*b),window.setTimeout(M,_*b)},500),typeof window.ontouchstart=="undefined"?(renderer.domElement.addEventListener("mousedown",K),renderer.domElement.addEventListener("mouseup",Y)):(renderer.domElement.addEventListener("touchstart",K),renderer.domElement.addEventListener("touchend",Y));const z=document.getElementById("hidden_cover"),es=document.getElementById("key-visual"),ed=es.getBoundingClientRect().bottom+window.pageYOffset,Q=ed-window.innerHeight*.88;window.addEventListener("scroll",()=>{J()}),en(),Z(),window.addEventListener("resize",Z);const F=document.getElementById("nav_block"),D=document.getElementById("anime_nav"),m=document.getElementById("hand"),k=document.getElementById("circle"),W=gsap.timeline(),X=gsap.timeline();W.to(m,{duration:.5,y:10,opacity:1}).to(m,{duration:.3,x:(D.clientWidth-m.clientWidth)*.8,opacity:.6}).to(m,{duration:.5,x:D.clientWidth-m.clientWidth,y:-10,opacity:0}),X.to(k,{duration:.5,y:10}).set(k,{opacity:.7}).to(k,{duration:.3,x:(D.clientWidth-m.clientWidth)*.8}).set(k,{opacity:0}).to(k,{duration:.5,x:D.clientWidth-m.clientWidth,y:-10}),W.repeat(-1),X.repeat(-1),window.setTimeout(()=>{P===!1&&(F.style.opacity=1,F.style.visibility="visible")},_*b+5e3),window.setTimeout(()=>{window.setInterval(e3,1e3)},_*b+5e3+n(10,5)*1e3);function eo(h,d,l,o){const s=document.createElement("canvas"),i=s.getContext("2d"),t=d,n=l;s.width=t,s.height=n,i.drawImage(h,0,0);const u=i.getImageData(0,0,t,n).data,a=[],r=[],c=[];for(let s=0;s<n;s+=o)for(let i=0;i<t;i+=o){const d=(s*t+i)*4,v=i-t/2,h=-(s-n/2),m=0;var e=[0,255];const f=e[Math.floor(Math.random()*e.length)],p=e[Math.floor(Math.random()*e.length)],g=e[Math.floor(Math.random()*e.length)],l=u[d+3]/255;l>0&&(a.push(v,h,m),r.push(f,p,g),c.push(l))}return{position:a,color:r,alpha:c}}function ei(n){for(var t,e=0;e<g;e++)h[e]>0&&(h[e]=.5**6);for(e=0;e<n;e++)for(t=0;t<g;t++)random=t+Math.floor(Math.random()*2)+1,h[random]>0&&(h[random]=.5**(e+7))}function ea(n,t){for(let o=0;o<g;o++){var s={x:h[o],y:a[o]},e=new TWEEN.Tween(s);e.to({x:1,y:1},t+1e3);for(j=0;j<n;j++)h[o]===.5**(j+6)&&(e.delay(j*t),e.start());e.onUpdate(function(e){h[o]=e.x,a[o]=e.y})}}function er(e,t){ei(e),ea(e+1,t)}function ec(){y==!1?y=!0:y=!1}function M(){p===!1?p=!0:p===!0&&(p=!1)}function G(){et=setTimeout(function(){R=Date.now()-I+N,G()},10),i=R/1e3}function K(e){c.x=e.clientX-window.innerWidth/2,c.y=-(e.clientY-window.innerHeight/2)+header_height+camera.position.y,w.x=e.clientX/window.innerWidth*2-1,w.y=-(e.clientY/window.innerHeight)*2+1,typeof window.ontouchstart!="undefined"&&(c.x=e.changedTouches[0].pageX-window.innerWidth/2,c.y=-(e.changedTouches[0].pageY-window.innerHeight/2)+header_height+camera.position.y,w.x=e.changedTouches[0].pageX/window.innerWidth*2-1,w.y=-(e.changedTouches[0].pageY/window.innerHeight)*2+1),B.setFromCamera(w,camera);var t=B.intersectObjects(V);t.length>0&&(e.preventDefault(),H=!0),I=Date.now(),G()}function Y(f){if(H===!0&&f.preventDefault(),v.x=f.clientX-window.innerWidth/2,v.y=-(f.clientY-window.innerHeight/2)+header_height+camera.position.y,typeof window.ontouchstart!="undefined"&&(v.x=f.changedTouches[0].pageX-window.innerWidth/2,v.y=-(f.changedTouches[0].pageY-window.innerHeight/2)+header_height+camera.position.y),o.x=v.x-c.x,o.y=v.y-c.y,l.x=Math.abs(o.x),l.y=Math.abs(o.y),y==!0)for(let f=0;f<g;f++){E.x=r.getX(f)*(500/camera.position.z)-8,E.y=r.getY(f)*(500/camera.position.z)+8;var h,m,b,_={x:r.getX(f),y:r.getY(f),z:a[f]},j=Math.sqrt(Math.pow(E.x-c.x,2)+Math.pow(E.y-c.y,2));if(typeof window.ontouchstart!="undefined"?(b=3):(b=2),a[f]===1&&j<5/(i*6)*b&i>.01){if(a[f]=0,o.x>0&l.y<20)s.x=1,s.y=0,d=n(50,40);else if(o.x<0&l.y<20)s.x=-1,s.y=0,d=n(50,40);else if(o.y>0&l.y>=20)s.x=0,s.y=1,d=n(50,40);else if(o.y<0&l.y>=20)s.x=0,s.y=-1,d=n(50,40);else if(l.x<5|l.y<5)return;S.x=d*s.x,S.y=d*s.y,t.x=u[3*f]+S.x+o.x/(i*20),t.y=u[3*f+1]+S.y+o.y/(i*20),h=new TWEEN.Tween(_),h.to({x:t.x,y:t.y,z:0},i*3e4),h.easing(TWEEN.Easing.Quadratic.Out),h.onUpdate(function(e){u[3*f]=e.x,u[3*f+1]=e.y,a[f]=e.z}),h.repeat(1),h.yoyo(!0),m=new TWEEN.Tween(T),m.to({x1:t.x/(i*1e3),y1:t.y*-1/(i*1e3),z1:e.position.z+2e3/(i*300),x2:t.y/1e3*-1,y2:t.x/1e3*-1},i*1e5),m.delay(2e3),m.onUpdate(function(t){e.position.x=t.x1,e.position.y=t.y1,e.position.z=t.z1,e.rotation.x=t.x2,e.rotation.y=t.y2}),m.repeat(1),m.yoyo(!0),h.start(),F.style.opacity=0,F.style.visibility="hidden",P=!0,p===!0&&(m.start(),M(),window.setTimeout(M,i*1e5*2+4e3))}}clearTimeout(et),N+=Date.now()-I,R=0,N=0,H=!1}function en(){var t=e2.getDelta();requestAnimationFrame(en),renderer.render(scene,camera),window.setTimeout(()=>{e.material.uniforms.u_time.value+=2*t},_*b-500),TWEEN.update(),e.geometry.attributes.alpha.needsUpdate=!0,e.geometry.attributes.position.needsUpdate=!0,e.geometry.attributes.flag.needsUpdate=!0}function Z(){const t=window.innerWidth,l=window.innerHeight,s=3840,o=2560,i=1920,a=1440,r=1280,n=840,c=650,d=370;typeof window.ontouchstart=="undefined"?t>=s?(camera.position.z=400,e.material.uniforms.u_value.value=13):t<s&t>=o?(camera.position.z=400,e.material.uniforms.u_value.value=8):t<o&t>=i?(camera.position.z=400,e.material.uniforms.u_value.value=3):t<i&t>=a?(camera.position.z=400,e.material.uniforms.u_value.value=1):t<a&t>=r?(camera.position.z=400,e.material.uniforms.u_value.value=0):t<r&t>=n?(camera.position.z=400,e.material.uniforms.u_value.value=0):t<n&t>=c?(camera.position.z=480,e.material.uniforms.u_value.value=-1):t<c&t>=d?(camera.position.z=880,e.material.uniforms.u_value.value=-6):(camera.position.z=800,e.material.uniforms.u_value.value=-6):t>=s?(camera.position.z=400,e.material.uniforms.u_value.value=13):t<s&t>=o?(camera.position.z=400,e.material.uniforms.u_value.value=6):t<o&t>=i?(camera.position.z=400,e.material.uniforms.u_value.value=4):t<i&t>=a?(camera.position.z=400,e.material.uniforms.u_value.value=1):t<a&t>=r?(camera.position.z=400,e.material.uniforms.u_value.value=0):t<r&t>=n?(camera.position.z=600,e.material.uniforms.u_value.value=0):t<n&t>=c?(camera.position.z=600,e.material.uniforms.u_value.value=1):t<c&t>=d?(camera.position.z=880,e.material.uniforms.u_value.value=-6):(camera.position.z=800,e.material.uniforms.u_value.value=-6),typeof window.ontouchstart=="undefined"?renderer.setSize(t-bar_width,l-header_height):renderer.setSize(t,l-header_height),camera.aspect=t/(l-header_height),camera.updateProjectionMatrix(),J()}function J(){window.scrollY>=Q?(z.style.opacity=.5,z.style.visibility="visible"):window.scrollY<Q&&(z.style.opacity=0,z.style.visibility="hidden")}function e3(){d=n(200,50);var s,o,i,c,l,h,m,v,b,j,_,w,k=[[Math.random(),Math.random()],[-1*Math.random(),Math.random()],[Math.random(),-1*Math.random()],[-1*Math.random(),-1*Math.random()]],E=k[Math.floor(Math.random()*k.length)],F=d*E[0],S=d*E[1];if(O.x=n(375,0),A.x=-1*n(400,0),O.y=n(410,0),A.y=-1*n(230,0),f.x=[O.x,A.x],f.y=[O.y,A.y],C.x=f.x[Math.floor(Math.random()*f.x.length)],C.y=f.y[Math.floor(Math.random()*f.y.length)],x.x=n(200,5)*ee(),x.y=n(200,5)*ee(),typeof window.ontouchstart!="undefined"?(h=30):(h=20),y==!0)for(let d=0;d<g;d++)w=r.getX(d)*(500/camera.position.z)-8,_=r.getY(d)*(500/camera.position.z)+8,j={x:r.getX(d),y:r.getY(d),z:a[d]},b=Math.sqrt(Math.pow(w-C.x,2)+Math.pow(_-C.y,2)),v=[[1,0],[-1,0],[0,1],[0,-1]],m=v[Math.floor(Math.random()*v.length)],$.x=m[0],$.y=m[1],s=n(110,80)*.001,a[d]===1&&b<h&&(a[d]=0,l=n(300,280)*n(1500,1e3),t.x=u[3*d]+F+x.x/(s*l),t.y=u[3*d+1]+S+x.y/(s*l),o=new TWEEN.Tween(j),o.to({x:t.x,y:t.y,z:0},s*l),o.easing(TWEEN.Easing.Quadratic.Out),o.onUpdate(function(e){u[3*d]=e.x,u[3*d+1]=e.y,a[d]=e.z}),o.repeat(1),o.yoyo(!0),i=new TWEEN.Tween(T),i.to({x1:t.x/(s*1e3),y1:t.y*-1/(s*1e3),z1:e.position.z+2e3/(s*500),x2:t.y/1e3*-1,y2:t.x/1e3*-1},1e4),i.delay(2e3),i.onUpdate(function(t){e.position.x=t.x1,e.position.y=t.y1,e.position.z=t.z1,e.rotation.x=t.x2,e.rotation.y=t.y2}),c=new TWEEN.Tween(T),c.to({x1:e.position.x,y1:e.position.y,z1:e.position.z,x2:e.rotation.x,y2:e.rotation.y},1e4),c.delay(2e3),c.onUpdate(function(t){e.position.x=t.x1,e.position.y=t.y1,e.position.z=t.z1,e.rotation.x=t.x2,e.rotation.y=t.y2}),i.chain(c),o.start(),P=!0,p===!0&e.position.z+2e3/(s*500)<=camera.position.z*.3&&(i.start(),M(),window.setTimeout(M,12e3*2)))}function n(t,e){return Math.floor(Math.random()*t+1-e)+e}function ee(){var e=[1,-1];return e[Math.floor(Math.random()*e.length)]}})