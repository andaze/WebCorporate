var scene=new THREE.Scene,renderer,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);camera.position.z=350,camera.position.x=0,camera.position.y=20,renderer=new THREE.WebGLRenderer,renderer.setSize(window.innerWidth,window.innerHeight);const wrapper=document.querySelector("#webgl");wrapper.appendChild(renderer.domElement);const geometry=new THREE.BufferGeometry,img=new Image;typeof window.ontouchstart=="undefined"?img.src="img/logo_pc.png":img.src="img/logo_mobile.png",window.onload=function(){const e=document.getElementById("loading");e.style.opacity=0,e.style.visibility="hidden",img.crossOrigin="anonymous",img.addEventListener("load",()=>{var h=I(img,img.width,img.height,2),e,u,b,g,y,v,t,E,w,d,o,r,n,s,m,l,f;const L=new THREE.BufferAttribute(new Float32Array(h.position),3),M=new THREE.BufferAttribute(new Float32Array(h.color),3),F=new THREE.BufferAttribute(new Float32Array(h.alpha),1),A=[],a=h.position.length/3;for(let e=0;e<a;e++)A.push((Math.random()-1)*2,(Math.random()-1)*2);const R=new THREE.BufferAttribute(new Float32Array(A),2),C=[];for(let e=0;e<a;e++)C.push(1);const P=new THREE.BufferAttribute(new Float32Array(C),1);geometry.setAttribute("position",L),geometry.setAttribute("color",M),geometry.setAttribute("alpha",F),geometry.setAttribute("rand",R),geometry.setAttribute("flag",P);const H=new THREE.RawShaderMaterial({vertexShader:document.querySelector("#js-vertex-shader").textContent,fragmentShader:document.querySelector("#js-fragment-shader").textContent,uniforms:{u_ratio:{type:"f",value:0},u_time:{type:"f",value:0},u_value:{type:"f",value:0},pointTexture:{value:(new THREE.TextureLoader).load("img/spark.png")}},transparent:!0,blending:THREE.AdditiveBlending,depthTest:!1});e=new THREE.Points(geometry,H),e.position.x=0,u=e.geometry.attributes.position;const i=e.geometry.attributes.alpha.array,B=e.geometry.attributes.color.array,c=e.geometry.attributes.flag.array;g=0,v=0,E=[],w=new THREE.Raycaster,d=new THREE.Vector2(-2,-2),o=new THREE.Vector2,r=new THREE.Vector2,n=new THREE.Vector2,s=new THREE.Vector2,m=!1,l=!1,f=!1,scene.add(e),E.push(e),D(3),window.setTimeout(N,4*2e3),window.setTimeout(p,4*2e3),typeof window.ontouchstart=="undefined"?(renderer.domElement.addEventListener("mousedown",x),renderer.domElement.addEventListener("mouseup",O)):(renderer.domElement.addEventListener("touchstart",x),renderer.domElement.addEventListener("touchend",O)),_(),S(),window.addEventListener("resize",S);function I(h,d,l,o){const s=document.createElement("canvas"),i=s.getContext("2d"),t=d,n=l;s.width=t,s.height=n,i.drawImage(h,0,0);const u=i.getImageData(0,0,t,n).data,a=[],r=[],c=[];for(let s=0;s<n;s+=o)for(let i=0;i<t;i+=o){const d=(s*t+i)*4,v=i-t/2,h=-(s-n/2),m=0;var e=[0,255];const f=e[Math.floor(Math.random()*e.length)],p=e[Math.floor(Math.random()*e.length)],g=e[Math.floor(Math.random()*e.length)],l=u[d+3]/255;l>0&&(a.push(v,h,m),r.push(f,p,g),c.push(l))}return{position:a,color:r,alpha:c}}function T(n){for(var e=0,t;e<a;e++)i[e]>0&&(i[e]=.5**6);for(e=0;e<n;e++)for(t=0;t<a;t++)random=t+Math.floor(Math.random()*2)+1,i[random]>0&&(i[random]=.5**(e+7))}function z(t){for(let s=0;s<a;s++){var n={x:i[s],y:c[s]},e=new TWEEN.Tween(n);e.to({x:1,y:1},3e3);for(j=0;j<t;j++)i[s]===.5**(j+6)&&(e.delay(j*2e3),e.start());e.onUpdate(function(e){i[s]=e.x,c[s]=e.y})}}function D(e){T(e),z(e+1)}function N(){m==!1?m=!0:m=!1}function p(){l===!1?l=!0:l===!0&&(l=!1)}function k(){y=setTimeout(function(){g=Date.now()-b+v,k()},10),t=g/1e3}function x(e){o.x=e.clientX-window.innerWidth/2,o.y=-(e.clientY-window.innerHeight/2)+camera.position.y,d.x=e.clientX/window.innerWidth*2-1,d.y=-(e.clientY/window.innerHeight)*2+1,typeof window.ontouchstart!="undefined"&&(o.x=e.changedTouches[0].pageX-window.innerWidth/2-20,o.y=-(e.changedTouches[0].pageY-window.innerHeight/2)+20+camera.position.y,d.x=e.changedTouches[0].pageX/window.innerWidth*2-1,d.y=-(e.changedTouches[0].pageY/window.innerHeight)*2+1),w.setFromCamera(d,camera);var t=w.intersectObjects(E);t.length>0&&(e.preventDefault(),f=!0),b=Date.now(),k()}function O(w){f===!0&&w.preventDefault();const O=e.geometry.attributes.position.array;if(r.x=w.clientX-window.innerWidth/2,r.y=-(w.clientY-window.innerHeight/2)+camera.position.y,typeof window.ontouchstart!="undefined"&&(r.x=w.changedTouches[0].pageX-window.innerWidth/2-20,r.y=-(w.changedTouches[0].pageY-window.innerHeight/2)+20+camera.position.y),n.x=r.x-o.x,n.y=r.y-o.y,s.x=Math.abs(n.x),s.y=Math.abs(n.y),m==!0)for(let r=0;r<a;r++){var z=u.getX(r)*(500/camera.position.z)-8,j,_,d,E,S,M,x,C,i,h,T=u.getY(r)*(500/camera.position.z)+8,F={x:u.getX(r),y:u.getY(r),z:c[r]},k={x1:e.position.x,y1:e.position.y,z1:e.position.z,x2:e.rotation.x,y2:e.rotation.y,z2:e.rotation.z},A=Math.sqrt(Math.pow(z-o.x,2)+Math.pow(T-o.y,2));if(typeof window.ontouchstart!="undefined"?E=3:E=2,c[r]===1)if(A<10/(t*6)*E&t>.01){if(c[r]=0,n.x>0&s.y<20)j=1,_=0,d=Math.floor(Math.random()*50+1-40)+40;else if(n.x<0&s.y<20)j=-1,_=0,d=Math.floor(Math.random()*50+1-40)+40;else if(n.y>0&s.y>=20)j=0,_=1,d=Math.floor(Math.random()*50+1-40)+40;else if(n.y<0&s.y>=20)j=0,_=-1,d=Math.floor(Math.random()*20+1-10)+10;else if(s.x<5|s.y<5)return;S=d*j,M=d*_,x=O[3*r]+S+n.x/(t*20),C=O[3*r+1]+M+n.y/(t*20),i=new TWEEN.Tween(F),i.to({x,y:C,z:0},t*3e4),i.easing(TWEEN.Easing.Quadratic.Out),i.onUpdate(function(e){O[3*r]=e.x,O[3*r+1]=e.y,c[r]=e.z}),i.repeat(1),i.yoyo(!0),h=new TWEEN.Tween(k),h.to({x1:x/(t*1e3),y1:C*-1/(t*1e3),z1:e.position.z+2e3/(t*300),x2:C/1e3*-1,y2:x/1e3*-1},t*1e5),h.delay(2e3),h.onUpdate(function(t){e.position.x=t.x1,e.position.y=t.y1,e.position.z=t.z1,e.rotation.x=t.x2,e.rotation.y=t.y2}),h.repeat(1),h.yoyo(!0),i.start(),l===!0&&(h.start(),p(),window.setTimeout(p,t*1e5*2+4e3))}}clearTimeout(y),v+=Date.now()-b,g=0,v=0,f=!1}function _(){requestAnimationFrame(_),renderer.render(scene,camera),e.material.uniforms.u_time.value+=.1,TWEEN.update(),e.geometry.attributes.alpha.needsUpdate=!0,e.geometry.attributes.position.needsUpdate=!0,e.geometry.attributes.flag.needsUpdate=!0}function S(){const t=window.innerWidth,o=window.innerHeight;var n,s;typeof window.ontouchstart=="undefined"?(n=855,s=650,t>=n?camera.position.z=350:t<n&t>=s?camera.position.z=450:camera.position.z=600):(n=960,s=540,t>=n?(camera.position.z=220,e.material.uniforms.u_value.value=10):t<n&t>=s?(e.material.uniforms.u_value.value=3,camera.position.z=330):(camera.position.z=480,e.material.uniforms.u_value.value=2)),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(t,o),camera.aspect=t/o,camera.updateProjectionMatrix()}})}