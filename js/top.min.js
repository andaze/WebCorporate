const loading_icon=document.getElementById("loading_icon");window.setTimeout(()=>{loading_icon.style.visibility="visible"},1);var scene=new THREE.Scene,camera,renderer;const width=window.innerWidth,height=window.innerHeight;camera=new THREE.PerspectiveCamera(75,width/height,.1,1500),camera.position.x=0,camera.position.y=30,renderer=new THREE.WebGLRenderer;const header_height=document.getElementById("header_nav").clientHeight,main_height=document.getElementById("top_main").clientHeight;document.querySelector("footer").style.marginTop=main_height+"px";const canvas=document.getElementById("webgl");canvas.style.marginTop=header_height+"px",renderer.setSize(width,height-header_height);const wrapper=document.querySelector("#webgl");wrapper.appendChild(renderer.domElement);const geometry=new THREE.BufferGeometry,img=new Image;img.src="../img/logo.png",img.crossOrigin="anonymous",img.addEventListener("load",()=>{var e,t,o,i,a,r,l,u,m,f,p,g,v,O,x,C,k,A,S,M,F,T,z,D,N,R,P,H,I,B,V,W,d=ee(img,img.width,img.height,2);const e0=new THREE.BufferAttribute(new Float32Array(d.position),3),e4=new THREE.BufferAttribute(new Float32Array(d.color),3),ei=new THREE.BufferAttribute(new Float32Array(d.alpha),1),$=[],h=d.position.length/3;for(let e=0;e<h;e++)$.push((Math.random()-1)*2,(Math.random()-1)*2);const ec=new THREE.BufferAttribute(new Float32Array($),2),Y=[];for(let e=0;e<h;e++)Y.push(1);const el=new THREE.BufferAttribute(new Float32Array(Y),1);geometry.setAttribute("position",e0),geometry.setAttribute("color",e4),geometry.setAttribute("alpha",ei),geometry.setAttribute("rand",ec),geometry.setAttribute("flag",el);const eu=new THREE.RawShaderMaterial({vertexShader:document.querySelector("#js-vertex-shader").textContent,fragmentShader:document.querySelector("#js-fragment-shader").textContent,uniforms:{u_ratio:{type:"f",value:0},u_time:{type:"f",value:0},u_value:{type:"f",value:0},pointTexture:{value:(new THREE.TextureLoader).load("../img/spark.png")}},transparent:!0,blending:THREE.AdditiveBlending,depthTest:!1});e=new THREE.Points(geometry,eu),e.position.x=0,t=e.geometry.attributes.position;const b=e.geometry.attributes.alpha.array,eh=e.geometry.attributes.color.array,s=e.geometry.attributes.position.array,c=e.geometry.attributes.flag.array,y=4,_=500;R=0,z=0;const J=new THREE.Clock;B=[],I=new THREE.Raycaster,O=new THREE.Vector2(-2,-2),m=new THREE.Vector2,v=new THREE.Vector2,i=new THREE.Vector2,u=new THREE.Vector2,T={x1:e.position.x,y1:e.position.y,z1:e.position.z,x2:e.rotation.x,y2:e.rotation.y,z2:e.rotation.z},l=new THREE.Vector2,a=new THREE.Vector2,A=new THREE.Vector2,o=new THREE.Vector2,S=new THREE.Vector2,M=new THREE.Vector2,p=new THREE.Vector2,C=new THREE.Vector2,P=new THREE.Vector2,k=new THREE.Vector2,x=!1,g=!1,F=!1,D=!1,N=!1,scene.add(e),B.push(e),window.setTimeout(()=>{const e=document.getElementById("loading");e.style.opacity=0,e.style.visibility="hidden",es(y-1,_),window.setTimeout(eo,y*_),window.setTimeout(E,y*_)},500),ed(),typeof window.ontouchstart=="undefined"?(renderer.domElement.addEventListener("mousedown",X),renderer.domElement.addEventListener("mouseup",G)):(renderer.domElement.addEventListener("touchstart",X),renderer.domElement.addEventListener("touchend",G));const L=document.getElementById("hidden_cover"),er=document.getElementById("key-visual"),ea=er.getBoundingClientRect().bottom+window.pageYOffset,Z=ea-height*.88;window.addEventListener("scroll",()=>{U()}),q(),K(),H=window.innerWidth,window.addEventListener("resize",function(){if(H==window.innerWidth&typeof window.ontouchstart!="undefined")return;H=window.innerWidth,K()}),e2(),window.setTimeout(()=>{window.setInterval(e1,1e3),window.addEventListener("blur",()=>{N=!0}),window.addEventListener("focus",()=>{N=!1})},y*_+5e3+n(5,1)*1e3);function ee(h,d,l,o){const s=document.createElement("canvas"),i=s.getContext("2d"),t=d,n=l;s.width=t,s.height=n,i.drawImage(h,0,0);const u=i.getImageData(0,0,t,n).data,a=[],r=[],c=[];for(let s=0;s<n;s+=o)for(let i=0;i<t;i+=o){const d=(s*t+i)*4,v=i-t/2,h=-(s-n/2),m=0;var e=[0,255];const f=e[Math.floor(Math.random()*e.length)],p=e[Math.floor(Math.random()*e.length)],g=e[Math.floor(Math.random()*e.length)],l=u[d+3]/255;l>0&&(a.push(v,h,m),r.push(f,p,g),c.push(l))}return{position:a,color:r,alpha:c}}function et(n){for(var t,e=0;e<h;e++)b[e]>0&&(b[e]=.5**6);for(e=0;e<n;e++)for(t=0;t<h;t++)random=t+Math.floor(Math.random()*2)+1,b[random]>0&&(b[random]=.5**(e+7))}function en(n,t){for(let o=0;o<h;o++){var s={x:b[o],y:c[o]},e=new TWEEN.Tween(s);e.to({x:1,y:1},t+1e3);for(j=0;j<n;j++)b[o]===.5**(j+6)&&(e.delay(j*t),e.start());e.onUpdate(function(e){b[o]=e.x,c[o]=e.y})}}function es(e,t){et(e),en(e+1,t)}function eo(){x==!1?x=!0:x=!1}function E(){g===!1?g=!0:g===!0&&(g=!1)}function Q(){W=setTimeout(function(){R=Date.now()-V+z,Q()},10),r=R/1e3}function X(e){m.x=e.clientX-width/2,m.y=-(e.clientY-height/2)+header_height+camera.position.y,O.x=e.clientX/width*2-1,O.y=-(e.clientY/height)*2+1,typeof window.ontouchstart!="undefined"&&(m.x=e.changedTouches[0].pageX-width/2,m.y=-(e.changedTouches[0].pageY-height/2)+header_height+camera.position.y,O.x=e.changedTouches[0].pageX/width*2-1,O.y=-(e.changedTouches[0].pageY/height)*2+1),I.setFromCamera(O,camera);var t=I.intersectObjects(B);t.length>0&&(e.preventDefault(),D=!0),V=Date.now(),Q()}function G(b){if(D===!0&&b.preventDefault(),v.x=b.clientX-width/2,v.y=-(b.clientY-height/2)+header_height+camera.position.y,typeof window.ontouchstart!="undefined"&&(v.x=b.changedTouches[0].pageX-width/2,v.y=-(b.changedTouches[0].pageY-height/2)+header_height+camera.position.y),i.x=v.x-m.x,i.y=v.y-m.y,u.x=Math.abs(i.x),u.y=Math.abs(i.y),x==!0)for(let v=0;v<h;v++){l.x=t.getX(v)*(500/camera.position.z)-8,l.y=t.getY(v)*(500/camera.position.z)+8;var d,p,j,_={x:t.getX(v),y:t.getY(v),z:c[v]},y=Math.sqrt(Math.pow(l.x-m.x,2)+Math.pow(l.y-m.y,2));if(typeof window.ontouchstart!="undefined"?(j=3):(j=2),c[v]===1&&y<5/(r*6)*j&r>.01){if(c[v]=0,i.x>0&u.y<20)a.x=1,a.y=0,f=n(50,40);else if(i.x<0&u.y<20)a.x=-1,a.y=0,f=n(50,40);else if(i.y>0&u.y>=20)a.x=0,a.y=1,f=n(50,40);else if(i.y<0&u.y>=20)a.x=0,a.y=-1,f=n(50,40);else if(u.x<5|u.y<5)return;A.x=f*a.x,A.y=f*a.y,o.x=s[3*v]+A.x+i.x/(r*20),o.y=s[3*v+1]+A.y+i.y/(r*20),d=new TWEEN.Tween(_),d.to({x:o.x,y:o.y,z:0},r*3e4),d.easing(TWEEN.Easing.Quadratic.Out),d.onUpdate(function(e){s[3*v]=e.x,s[3*v+1]=e.y,c[v]=e.z}),d.repeat(1),d.yoyo(!0),p=new TWEEN.Tween(T),p.to({x1:o.x/(r*1e3),y1:o.y*-1/(r*1e3),z1:e.position.z+2e3/(r*300),x2:o.y/1e3*-1,y2:o.x/1e3*-1},r*1e5),p.delay(2e3),p.onUpdate(function(t){e.position.x=t.x1,e.position.y=t.y1,e.position.z=t.z1,e.rotation.x=t.x2,e.rotation.y=t.y2}),p.repeat(1),p.yoyo(!0),d.start(),nav_block.style.opacity=0,nav_block.style.visibility="hidden",F=!0,g===!0&&(p.start(),E(),window.setTimeout(E,r*1e5*2+4e3))}}clearTimeout(W),z+=Date.now()-V,R=0,z=0,D=!1}function q(){var t=J.getDelta();requestAnimationFrame(q),renderer.render(scene,camera),window.setTimeout(()=>{e.material.uniforms.u_time.value+=2*t},y*_-500),TWEEN.update(),e.geometry.attributes.alpha.needsUpdate=!0,e.geometry.attributes.position.needsUpdate=!0,e.geometry.attributes.flag.needsUpdate=!0}function K(){const t=window.innerWidth,n=window.innerHeight,s=document.getElementById("header_nav").clientHeight;canvas.style.marginTop=s+"px";const o=700,i=864,a=1440;camera.aspect=t/(n-s),camera.updateProjectionMatrix(),typeof window.ontouchstart=="undefined"?t>=o?(camera.position.z=400,n<=i?e.material.uniforms.u_value.value=(t+n)/800-(1200+n)/t:e.material.uniforms.u_value.value=(t+n)/500-(1200+n)/t):(camera.position.z=n/t*400,e.material.uniforms.u_value.value=(t+n)/800-(1200+n)/t):t>=a?t<n?(camera.position.z=n/t*500,e.material.uniforms.u_value.value=(t+n)/500-(1200+n)/t):camera.aspect>1.85?(camera.position.z=t/n*250,e.material.uniforms.u_value.value=(t+n)/800-(2800+n)/t):(camera.position.z=t/n*350,e.material.uniforms.u_value.value=(t+n)/500-(2800+n)/t):t<n?(camera.position.z=n/t*400,e.material.uniforms.u_value.value=(t+n)/500-(1600+n)/t):camera.aspect>1.8?(camera.position.z=t/n*250,e.material.uniforms.u_value.value=(t+n)/800-(3400+n)/t):(camera.position.z=t/n*350,e.material.uniforms.u_value.value=(t+n)/800-(2800+n)/t),renderer.setSize(t,n-s),U()}function U(){window.scrollY>=Z?(L.style.opacity=.5,L.style.visibility="visible"):window.scrollY<Z&&(L.style.opacity=0,L.style.visibility="hidden")}function e1(){if(N===!0)return;f=n(200,50);var i,a,r,l,d,u,m,v,b,j,y,_,A=[[Math.random(),Math.random()],[-1*Math.random(),Math.random()],[Math.random(),-1*Math.random()],[-1*Math.random(),-1*Math.random()]],O=A[Math.floor(Math.random()*A.length)],D=f*O[0],z=f*O[1];if(S.x=n(375,0),M.x=-1*n(400,0),S.y=n(410,0),M.y=-1*n(230,0),p.x=[S.x,M.x],p.y=[S.y,M.y],C.x=p.x[Math.floor(Math.random()*p.x.length)],C.y=p.y[Math.floor(Math.random()*p.y.length)],k.x=n(200,5)*w(),k.y=n(200,5)*w(),typeof window.ontouchstart!="undefined"?(u=30):(u=20),x==!0)for(let f=0;f<h;f++)_=t.getX(f)*(500/camera.position.z)-8,y=t.getY(f)*(500/camera.position.z)+8,j={x:t.getX(f),y:t.getY(f),z:c[f]},b=Math.sqrt(Math.pow(_-C.x,2)+Math.pow(y-C.y,2)),v=[[1,0],[-1,0],[0,1],[0,-1]],m=v[Math.floor(Math.random()*v.length)],P.x=m[0],P.y=m[1],i=n(110,80)*.001,c[f]===1&&b<u&&(c[f]=0,d=n(300,280)*n(1500,1e3),o.x=s[3*f]+D+k.x/(i*d),o.y=s[3*f+1]+z+k.y/(i*d),a=new TWEEN.Tween(j),a.to({x:o.x,y:o.y,z:0},i*d),a.easing(TWEEN.Easing.Quadratic.Out),a.onUpdate(function(e){s[3*f]=e.x,s[3*f+1]=e.y,c[f]=e.z}),a.repeat(1),a.yoyo(!0),r=new TWEEN.Tween(T),r.to({x1:o.x/(i*1e3),y1:o.y*-1/(i*1e3),z1:e.position.z+2e3/(i*500),x2:o.y/1e3*-1,y2:o.x/1e3*-1},1e4),r.delay(2e3),r.onUpdate(function(t){e.position.x=t.x1,e.position.y=t.y1,e.position.z=t.z1,e.rotation.x=t.x2,e.rotation.y=t.y2}),l=new TWEEN.Tween(T),l.to({x1:e.position.x,y1:e.position.y,z1:e.position.z,x2:e.rotation.x,y2:e.rotation.y},1e4),l.delay(2e3),l.onUpdate(function(t){e.position.x=t.x1,e.position.y=t.y1,e.position.z=t.z1,e.rotation.x=t.x2,e.rotation.y=t.y2}),r.chain(l),a.start(),F=!0,g===!0&e.position.z+2e3/(i*500)<=camera.position.z*.3&&(r.start(),E(),window.setTimeout(E,12e3*2)))}function n(t,e){return Math.floor(Math.random()*t+1-e)+e}function w(){var e=[1,-1];return e[Math.floor(Math.random()*e.length)]}function e3(){gsap.set(e.material.uniforms.u_ratio,{value:1e4}),window.setTimeout(()=>{gsap.to(e.material.uniforms.u_ratio,{value:0,duration:5,ease:"power4.out"})},0)}function ed(){for(let i=0;i<h;i++){s[3*i]=n(600,0)*w(),s[3*i+1]=n(600,0)*w(),l.x=t.getX(i)*(500/camera.position.z)-8,l.y=t.getY(i)*(500/camera.position.z)+8;var o={x:t.getX(i),y:t.getY(i)},e=new TWEEN.Tween(o);e.to({x:d.position[3*i],y:d.position[3*i+1]},3e3),e.easing(TWEEN.Easing.Quadratic.Out),e.onUpdate(function(e){s[3*i]=e.x,s[3*i+1]=e.y}),e.start()}}function em(){for(let i=0;i<h;i++){s[3*i]=n(600,0)*w(),s[3*i+1]=n(600,0)*w(),s[3*i+2]=1e3,l.x=t.getX(i)*(500/camera.position.z)-8,l.y=t.getY(i)*(500/camera.position.z)+8,l.z=t.getZ(i)*(500/camera.position.z);var o={x:t.getX(i),y:t.getY(i),z:t.getZ(i)},e=new TWEEN.Tween(o);e.to({x:d.position[3*i],y:d.position[3*i+1],z:d.position[3*i+2]},3e3),e.easing(TWEEN.Easing.Quadratic.Out),e.onUpdate(function(e){s[3*i]=e.x,s[3*i+1]=e.y,s[3*i+2]=e.z}),e.start()}}function e2(){const t=document.getElementById("nav_block"),e=document.getElementById("circle"),n=gsap.timeline();n.to(e,{duration:.5,opacity:.7,y:5}).to(e,{duration:.5,x:anime_nav.clientWidth*.5}).to(e,{duration:.8,opacity:0,x:anime_nav.clientWidth*.8,y:-5}),n.repeat(-1),window.setTimeout(()=>{F===!1&&(t.style.opacity=1,t.style.visibility="visible")},y*_+5e3)}})