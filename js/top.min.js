const loading_icon=document.getElementById("loading_icon");window.setTimeout(()=>{loading_icon.style.visibility="visible"},1);var scene=new THREE.Scene,renderer,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);camera.position.z=400,camera.position.x=0,camera.position.y=30,console.log(camera.position.z),renderer=new THREE.WebGLRenderer;const header_height=document.getElementById("header_nav").clientHeight,bar_width=17,main_height=document.getElementById("top_main").clientHeight;document.querySelector("footer").style.marginTop=main_height+"px";const canvas=document.getElementById("webgl");canvas.style.marginTop=header_height+"px",typeof window.ontouchstart=="undefined"?renderer.setSize(window.innerWidth-bar_width,window.innerHeight-header_height):renderer.setSize(window.innerWidth,window.innerHeight-header_height);const wrapper=document.querySelector("#webgl");wrapper.appendChild(renderer.domElement);const geometry=new THREE.BufferGeometry,img=new Image;img.src="../img/logo.png",img.crossOrigin="anonymous",img.addEventListener("load",()=>{var e,t,n,s,o,a,d,u,h,g,v,_,O,C,E,A,S,z,x=U(img,img.width,img.height,2);const G=new THREE.BufferAttribute(new Float32Array(x.position),3),et=new THREE.BufferAttribute(new Float32Array(x.color),3),$=new THREE.BufferAttribute(new Float32Array(x.alpha),1),H=[],c=x.position.length/3;for(let e=0;e<c;e++)H.push((Math.random()-1)*2,(Math.random()-1)*2);const Q=new THREE.BufferAttribute(new Float32Array(H),2),M=[];for(let e=0;e<c;e++)M.push(1);const Z=new THREE.BufferAttribute(new Float32Array(M),1);geometry.setAttribute("position",G),geometry.setAttribute("color",et),geometry.setAttribute("alpha",$),geometry.setAttribute("rand",Q),geometry.setAttribute("flag",Z);const J=new THREE.RawShaderMaterial({vertexShader:document.querySelector("#js-vertex-shader").textContent,fragmentShader:document.querySelector("#js-fragment-shader").textContent,uniforms:{u_ratio:{type:"f",value:0},u_time:{type:"f",value:0},u_value:{type:"f",value:0},pointTexture:{value:(new THREE.TextureLoader).load("../img/spark.png")}},transparent:!0,blending:THREE.AdditiveBlending,depthTest:!1});e=new THREE.Points(geometry,J),e.position.x=0,g=e.geometry.attributes.position;const r=e.geometry.attributes.alpha.array,en=e.geometry.attributes.color.array,l=e.geometry.attributes.flag.array,m=4,f=500;_=0,O=0;const ee=new THREE.Clock;E=[],S=new THREE.Raycaster,u=new THREE.Vector2(-2,-2),s=new THREE.Vector2,a=new THREE.Vector2,n=new THREE.Vector2,o=new THREE.Vector2,h=!1,d=!1,A=!1,v=!1,scene.add(e),E.push(e),window.setTimeout(()=>{const e=document.getElementById("loading");e.style.opacity=0,e.style.visibility="hidden",Y(m-1,f),window.setTimeout(V,m*f),window.setTimeout(k,m*f)},500),typeof window.ontouchstart=="undefined"?(renderer.domElement.addEventListener("mousedown",D),renderer.domElement.addEventListener("mouseup",T)):(renderer.domElement.addEventListener("touchstart",D),renderer.domElement.addEventListener("touchend",T));const b=document.getElementById("hidden_cover"),X=document.getElementById("key-visual"),W=X.getBoundingClientRect().bottom+window.pageYOffset,P=W-window.innerHeight*.88;window.addEventListener("scroll",()=>{B()}),F(),L(),window.addEventListener("resize",L);const y=document.getElementById("nav_block"),w=document.getElementById("anime_nav"),i=document.getElementById("hand"),p=document.getElementById("circle"),I=gsap.timeline(),R=gsap.timeline();I.to(i,{duration:.5,y:10,opacity:1}).to(i,{duration:.3,x:(w.clientWidth-i.clientWidth)*.8,opacity:.6}).to(i,{duration:.5,x:w.clientWidth-i.clientWidth,y:-10,opacity:0}),R.to(p,{duration:.5,y:10}).set(p,{opacity:.7}).to(p,{duration:.3,x:(w.clientWidth-i.clientWidth)*.8}).set(p,{opacity:0}).to(p,{duration:.5,x:w.clientWidth-i.clientWidth,y:-10}),I.repeat(-1),R.repeat(-1),window.setTimeout(()=>{A===!1&&(y.style.opacity=1,y.style.visibility="visible")},m*f+5e3);function U(h,d,l,o){const s=document.createElement("canvas"),i=s.getContext("2d"),t=d,n=l;s.width=t,s.height=n,i.drawImage(h,0,0);const u=i.getImageData(0,0,t,n).data,a=[],r=[],c=[];for(let s=0;s<n;s+=o)for(let i=0;i<t;i+=o){const d=(s*t+i)*4,v=i-t/2,h=-(s-n/2),m=0;var e=[0,255];const f=e[Math.floor(Math.random()*e.length)],p=e[Math.floor(Math.random()*e.length)],g=e[Math.floor(Math.random()*e.length)],l=u[d+3]/255;l>0&&(a.push(v,h,m),r.push(f,p,g),c.push(l))}return{position:a,color:r,alpha:c}}function K(n){for(var t,e=0;e<c;e++)r[e]>0&&(r[e]=.5**6);for(e=0;e<n;e++)for(t=0;t<c;t++)random=t+Math.floor(Math.random()*2)+1,r[random]>0&&(r[random]=.5**(e+7))}function q(n,t){for(let o=0;o<c;o++){var s={x:r[o],y:l[o]},e=new TWEEN.Tween(s);e.to({x:1,y:1},t+1e3);for(j=0;j<n;j++)r[o]===.5**(j+6)&&(e.delay(j*t),e.start());e.onUpdate(function(e){r[o]=e.x,l[o]=e.y})}}function Y(e,t){K(e),q(e+1,t)}function V(){h==!1?h=!0:h=!1}function k(){d===!1?d=!0:d===!0&&(d=!1)}function N(){z=setTimeout(function(){_=Date.now()-C+O,N()},10),t=_/1e3}function D(e){console.log("A"),s.x=e.clientX-window.innerWidth/2,s.y=-(e.clientY-window.innerHeight/2)+header_height+camera.position.y,u.x=e.clientX/window.innerWidth*2-1,u.y=-(e.clientY/window.innerHeight)*2+1,typeof window.ontouchstart!="undefined"&&(s.x=e.changedTouches[0].pageX-window.innerWidth/2,s.y=-(e.changedTouches[0].pageY-window.innerHeight/2)+header_height+camera.position.y,u.x=e.changedTouches[0].pageX/window.innerWidth*2-1,u.y=-(e.changedTouches[0].pageY/window.innerHeight)*2+1),S.setFromCamera(u,camera);var t=S.intersectObjects(E);t.length>0&&(e.preventDefault(),v=!0),C=Date.now(),N()}function T(p){v===!0&&p.preventDefault();const w=e.geometry.attributes.position.array;if(a.x=p.clientX-window.innerWidth/2,a.y=-(p.clientY-window.innerHeight/2)+header_height+camera.position.y,typeof window.ontouchstart!="undefined"&&(a.x=p.changedTouches[0].pageX-window.innerWidth/2,a.y=-(p.changedTouches[0].pageY-window.innerHeight/2)+header_height+camera.position.y),n.x=a.x-s.x,n.y=a.y-s.y,o.x=Math.abs(n.x),o.y=Math.abs(n.y),h==!0)for(let a=0;a<c;a++){var i,r,u,m,f,b,j,x,M,F,N=g.getX(a)*(500/camera.position.z)-8,D=g.getY(a)*(500/camera.position.z)+8,T={x:g.getX(a),y:g.getY(a),z:l[a]},E={x1:e.position.x,y1:e.position.y,z1:e.position.z,x2:e.rotation.x,y2:e.rotation.y,z2:e.rotation.z},S=Math.sqrt(Math.pow(N-s.x,2)+Math.pow(D-s.y,2));if(typeof window.ontouchstart!="undefined"?x=3:x=2,l[a]===1&&S<5/(t*6)*x&t>.01){if(l[a]=0,n.x>0&o.y<20)m=1,f=0,u=Math.floor(Math.random()*50+1-40)+40;else if(n.x<0&o.y<20)m=-1,f=0,u=Math.floor(Math.random()*50+1-40)+40;else if(n.y>0&o.y>=20)m=0,f=1,u=Math.floor(Math.random()*50+1-40)+40;else if(n.y<0&o.y>=20)m=0,f=-1,u=Math.floor(Math.random()*20+1-10)+10;else if(o.x<5|o.y<5)return;M=u*m,F=u*f,b=w[3*a]+M+n.x/(t*20),j=w[3*a+1]+F+n.y/(t*20),i=new TWEEN.Tween(T),i.to({x:b,y:j,z:0},t*3e4),i.easing(TWEEN.Easing.Quadratic.Out),i.onUpdate(function(e){w[3*a]=e.x,w[3*a+1]=e.y,l[a]=e.z}),i.repeat(1),i.yoyo(!0),r=new TWEEN.Tween(E),r.to({x1:b/(t*1e3),y1:j*-1/(t*1e3),z1:e.position.z+2e3/(t*300),x2:j/1e3*-1,y2:b/1e3*-1},t*1e5),r.delay(2e3),r.onUpdate(function(t){e.position.x=t.x1,e.position.y=t.y1,e.position.z=t.z1,e.rotation.x=t.x2,e.rotation.y=t.y2}),r.repeat(1),r.yoyo(!0),i.start(),y.style.opacity=0,y.style.visibility="hidden",A=!0,d===!0&&(r.start(),k(),window.setTimeout(k,t*1e5*2+4e3))}}clearTimeout(z),O+=Date.now()-C,_=0,O=0,v=!1}function F(){var t=ee.getDelta();requestAnimationFrame(F),renderer.render(scene,camera),window.setTimeout(()=>{e.material.uniforms.u_time.value+=2*t},m*f-500),TWEEN.update(),e.geometry.attributes.alpha.needsUpdate=!0,e.geometry.attributes.position.needsUpdate=!0,e.geometry.attributes.flag.needsUpdate=!0}function L(){const t=window.innerWidth,l=window.innerHeight,s=3840,o=2560,i=1920,a=1440,r=1280,n=840,c=650,d=370;typeof window.ontouchstart=="undefined"?t>=s?(camera.position.z=400,e.material.uniforms.u_value.value=13):t<s&t>=o?(camera.position.z=400,e.material.uniforms.u_value.value=8):t<o&t>=i?(camera.position.z=400,e.material.uniforms.u_value.value=3):t<i&t>=a?(camera.position.z=400,e.material.uniforms.u_value.value=1):t<a&t>=r?(camera.position.z=400,e.material.uniforms.u_value.value=0):t<r&t>=n?(camera.position.z=400,e.material.uniforms.u_value.value=0):t<n&t>=c?(camera.position.z=480,e.material.uniforms.u_value.value=-1):t<c&t>=d?(camera.position.z=880,e.material.uniforms.u_value.value=-6):(camera.position.z=800,e.material.uniforms.u_value.value=-6):t>=s?(camera.position.z=400,e.material.uniforms.u_value.value=13):t<s&t>=o?(camera.position.z=400,e.material.uniforms.u_value.value=6):t<o&t>=i?(camera.position.z=400,e.material.uniforms.u_value.value=4):t<i&t>=a?(camera.position.z=400,e.material.uniforms.u_value.value=1):t<a&t>=r?(camera.position.z=400,e.material.uniforms.u_value.value=0):t<r&t>=n?(camera.position.z=600,e.material.uniforms.u_value.value=0):t<n&t>=c?(camera.position.z=600,e.material.uniforms.u_value.value=1):t<c&t>=d?(camera.position.z=880,e.material.uniforms.u_value.value=-6):(camera.position.z=800,e.material.uniforms.u_value.value=-6),typeof window.ontouchstart=="undefined"?renderer.setSize(t-bar_width,l-header_height):renderer.setSize(t,l-header_height),camera.aspect=t/(l-header_height),camera.updateProjectionMatrix(),B()}function B(){window.scrollY>=P?(b.style.opacity=.5,b.style.visibility="visible"):window.scrollY<P&&(b.style.opacity=0,b.style.visibility="hidden")}})